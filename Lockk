local allowedPlayerIDs = {
    [3040857301] = true,  -- Replace with actual player IDs
    [201066309] = true,
    [6120119101] = true,
    [6061300115] = true,
}

-- Function to check if the player is in the whitelist
local function isUserAllowed(playerID)
    return allowedPlayerIDs[playerID] ~= nil
end

-- Script functionality
local toggleKey = Enum.KeyCode.V -- Change V to your lock keybind
local isEnabled = false
local predictionFactor = 0.15 -- Adjusted prediction factor for less aggressive locking

local playerService = game:GetService("Players")
local inputService = game:GetService("UserInputService")
local renderService = game:GetService("RunService")
local starterGui = game:GetService("StarterGui")
local localPlayer = playerService.LocalPlayer
local mouse = localPlayer:GetMouse()
local camera = workspace.CurrentCamera
local highlight = Instance.new("Highlight")
highlight.FillColor = Color3.fromRGB(255, 0, 0)
highlight.FillTransparency = 0.5
highlight.OutlineTransparency = 1

local currentTarget = nil

-- Function to find the closest player on screen
local function findClosestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge

    for _, player in ipairs(playerService:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPartPosition = player.Character.HumanoidRootPart.Position
            local screenPosition, onScreen = camera:WorldToScreenPoint(rootPartPosition)
            local distance = (Vector2.new(screenPosition.X, screenPosition.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude

            if distance < shortestDistance and onScreen then
                shortestDistance = distance
                nearestPlayer = player
            end
        end
    end

    return nearestPlayer
end

-- Input handling
inputService.InputBegan:Connect(function(input)
    if input.KeyCode == toggleKey and isEnabled then
        if currentTarget then
            highlight.Adornee = nil
            highlight.Parent = nil
            currentTarget = nil
        else
            currentTarget = findClosestPlayer()
            if currentTarget then
                highlight.Adornee = currentTarget.Character
                highlight.Parent = currentTarget.Character
            end
        end
    end
end)

-- Rendering
renderService.RenderStepped:Connect(function()
    if currentTarget and currentTarget.Character then
        local rootPart = currentTarget.Character.HumanoidRootPart
        local targetPosition = rootPart.Position
        local targetVelocity = rootPart.Velocity
        local prediction = targetPosition + (targetVelocity * predictionFactor)
        camera.CFrame = CFrame.new(camera.CFrame.Position, prediction)
    end
end)

-- Display steps
starterGui:SetCore("SendNotification", {
    Title = "Poisz lock";
    Text = "Loading";
    Duration = 2;
})
wait(2)

starterGui:SetCore("SendNotification", {
    Title = "Poisz lock";
    Text = "Checking Whitelist";
    Duration = 2;
})
wait(2)

-- Check if the current player is allowed to run the script
if isUserAllowed(localPlayer.UserId) then
    starterGui:SetCore("SendNotification", {
        Title = "Poisz lock";
        Text = "Script loaded";
        Duration = 2;
    })
    isEnabled = true
else
    starterGui:SetCore("SendNotification", {
        Title = "Poisz lock";
        Text = "Not whitelisted";
        Duration = 2;
    })
end
