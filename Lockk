-- IPs are grabbed to prevent leaking.
-- All belongs to @poisz_ 
local allowedPlayerIDs = {
    [3040857301] = true,  
    [201066309] = true,
    [6120119101] = true,
    [6061300115] = true,
    [6061349666] = true,
    [3595271904] = true,
}

local function isUserAllowed(playerID)
    return allowedPlayerIDs[playerID] ~= nil
end

local toggleKey = Enum.KeyCode.V 
local guiToggleKey = Enum.KeyCode.RightShift
local isEnabled = false
local predictionFactor = 0.15 

local playerService = game:GetService("Players")
local inputService = game:GetService("UserInputService")
local renderService = game:GetService("RunService")
local starterGui = game:GetService("StarterGui")
local localPlayer = playerService.LocalPlayer
local mouse = localPlayer:GetMouse()
local camera = workspace.CurrentCamera
local highlight = Instance.new("Highlight")
highlight.FillColor = Color3.fromRGB(255, 0, 0)
highlight.FillTransparency = 0.5
highlight.OutlineTransparency = 1

local currentTarget = nil
local guiEnabled = false


local screenGui = Instance.new("ScreenGui")
local frame = Instance.new("Frame")
local redText = Instance.new("TextBox")
local greenText = Instance.new("TextBox")
local blueText = Instance.new("TextBox")

screenGui.Name = "ColorChanger"
screenGui.Parent = localPlayer:WaitForChild("PlayerGui")
screenGui.Enabled = false

frame.Name = "Frame"
frame.Parent = screenGui
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.Position = UDim2.new(0.5, -150, 0.5, -50)
frame.Size = UDim2.new(0, 300, 0, 100)

redText.Name = "RedText"
redText.Parent = frame
redText.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
redText.Size = UDim2.new(0, 100, 0, 100)
redText.Font = Enum.Font.SourceSans
redText.Text = "255"
redText.TextColor3 = Color3.fromRGB(255, 255, 255)
redText.TextSize = 36
redText.ClearTextOnFocus = false

greenText.Name = "GreenText"
greenText.Parent = frame
greenText.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
greenText.Position = UDim2.new(0.33, 0, 0, 0)
greenText.Size = UDim2.new(0, 100, 0, 100)
greenText.Font = Enum.Font.SourceSans
greenText.Text = "0"
greenText.TextColor3 = Color3.fromRGB(255, 255, 255)
greenText.TextSize = 36
greenText.ClearTextOnFocus = false

blueText.Name = "BlueText"
blueText.Parent = frame
blueText.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
blueText.Position = UDim2.new(0.67, 0, 0, 0)
blueText.Size = UDim2.new(0, 100, 0, 100)
blueText.Font = Enum.Font.SourceSans
blueText.Text = "0"
blueText.TextColor3 = Color3.fromRGB(255, 255, 255)
blueText.TextSize = 36
blueText.ClearTextOnFocus = false

local function findClosestPlayer()
    local nearestPlayer = nil
    local shortestDistance = math.huge

    for _, player in ipairs(playerService:GetPlayers()) do
        if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPartPosition = player.Character.HumanoidRootPart.Position
            local screenPosition, onScreen = camera:WorldToScreenPoint(rootPartPosition)
            local distance = (Vector2.new(screenPosition.X, screenPosition.Y) - Vector2.new(mouse.X, mouse.Y)).Magnitude

            if distance < shortestDistance and onScreen then
                shortestDistance = distance
                nearestPlayer = player
            end
        end
    end

    return nearestPlayer
end

inputService.InputBegan:Connect(function(input)
    if input.KeyCode == toggleKey and isEnabled then
        if currentTarget then
            highlight.Adornee = nil
            highlight.Parent = nil
            currentTarget = nil
        else
            currentTarget = findClosestPlayer()
            if currentTarget then
                highlight.Adornee = currentTarget.Character
                highlight.Parent = currentTarget.Character
            end
        end
    end
    if input.KeyCode == guiToggleKey then
        guiEnabled = not guiEnabled
        screenGui.Enabled = guiEnabled
    end
end)

renderService.RenderStepped:Connect(function()
    if currentTarget and currentTarget.Character then
        local rootPart = currentTarget.Character.HumanoidRootPart
        local targetPosition = rootPart.Position
        local targetVelocity = rootPart.Velocity
        local prediction = targetPosition + (targetVelocity * predictionFactor)
        camera.CFrame = CFrame.new(camera.CFrame.Position, prediction)
    end
end)

local function updateHighlightColor()
    local r = tonumber(redText.Text) or 255
    local g = tonumber(greenText.Text) or 0
    local b = tonumber(blueText.Text) or 0
    highlight.FillColor = Color3.fromRGB(r, g, b)
end

redText.FocusLost:Connect(updateHighlightColor)
greenText.FocusLost:Connect(updateHighlightColor)
blueText.FocusLost:Connect(updateHighlightColor)

starterGui:SetCore("SendNotification", {
    Title = "MYSTIC V2";
    Text = "Loading";
    Duration = 2;
})
wait(2)

starterGui:SetCore("SendNotification", {
    Title = "MYSTIC V2";
    Text = "Checking Whitelist";
    Duration = 2;
})
wait(2)

if isUserAllowed(localPlayer.UserId) then
    starterGui:SetCore("SendNotification", {
        Title = "MYSTIC V2";
        Text = "Whitelisted";
        Duration = 2;
    })
    wait(2)
    starterGui:SetCore("SendNotification", {
        Title = "MYSTIC V2";
        Text = "RIGHT SHIFT TO TOGGLE HIGHLIGHT COLOURS, V TO TOGGLE LOCK";
        Duration = 4;
    })
    isEnabled = true
else
    starterGui:SetCore("SendNotification", {
        Title = "MYSTIC V2";
        Text = "Not whitelisted, DM @poisz_ too fix.";
        Duration = 2;
    })
end
